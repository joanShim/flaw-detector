"use client";

import { updateRealTimeTopic } from "@/lib/api/posts";
import React, { useEffect, useState } from "react";
import IconMagnifierWithPlus from "../ui/icons/IconMagnifierWithPlus";
import { showToast } from "./Toast";
import { processSearchInput } from "@/lib/utils";

export default function Search({
  setCurrentPage,
  setSearchTerm,
}: {
  setCurrentPage: React.Dispatch<React.SetStateAction<number>>;
  setSearchTerm: React.Dispatch<React.SetStateAction<string[]>>;
}) {
  const [searchInput, setSearchInput] = useState("");

  useEffect(() => {
    if (searchInput.trim() === "") {
      setSearchTerm([]);
      setCurrentPage(1);
    }
  }, [searchInput]);

  const onSubmitForm = (e: React.FormEvent) => {
    e.preventDefault();

    if (!searchInput) return showToast("❗ 검색어를 입력해주세요");

    const searchKeywords = processSearchInput(searchInput);

    setSearchTerm(searchKeywords);
    updateRealTimeTopic(searchInput);
    setCurrentPage(1);
  };

  return (
    <form onSubmit={onSubmitForm}>
      <div className="relative h-[5.125rem] w-full rounded-[14px] bg-gradient-to-r from-[#6100FF] to-[#4F6BFF] p-[0.15rem]">
        <input
          type="text"
          value={searchInput}
          onChange={(e) => setSearchInput(e.target.value)}
          className="flex-center-center h-full w-full rounded-[12px] bg-white pl-6 pr-20 text-2xl font-medium text-black outline-none placeholder:text-gray-light"
          placeholder="검색어를 입력해주세요."
        />
        <button
          type="submit"
          id="search-button"
          className="absolute right-6 top-1/2 -translate-y-1/2 transform"
        >
          <IconMagnifierWithPlus className="w-[1.625rem]" />
        </button>
      </div>
    </form>
  );
}
